---
# https://pegasus.isi.edu/documentation/service_apache.php
- name: Yum install mod_wsgi
  yum:
    name:
      - mod_wsgi

- name: create pegasus directory
  file:
    path: /var/www/pegasus
    state: directory

- name: Copy pegasus wsgi file
  copy:
    src: /usr/share/pegasus/service/pegasus-service.wsgi
    dest: /var/www/pegasus/pegasus-service.wsgi
    owner: apache
    group: apache
    mode: '0644'
    force: no

- name: Do not manage authentication on the dashboard
  lineinfile:
    path: /var/www/pegasus/pegasus-service.wsgi
    regexp: '^AUTHENTICATION\s*='
    line: 'AUTHENTICATION = "NoAuthentication"'

- name: No need to switch users
  lineinfile:
    path: /var/www/pegasus/pegasus-service.wsgi
    regexp: '^PROCESS_SWITCHING\s*='
    line: 'PROCESS_SWITCHING = False'

- name: Allow all users to see each other's dashboard
  lineinfile:
    path: /var/www/pegasus/pegasus-service.wsgi
    regexp: '^ADMIN_USERS\s*='
    line: 'ADMIN_USERS = "*"'

- name: Copy pegasus httd.conf file
  copy:
    src: /usr/share/pegasus/service/pegasus-service-httpd.conf
    dest: /etc/httpd/conf.d/pegasus.conf
    owner: apache
    group: apache
    mode: '0644'
    force: no

